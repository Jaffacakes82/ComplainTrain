function postComplaint(){var n=$(this).data("url");$.post(n,complaintToPost,function(n){var t=$("#complain-modal"),i='<i class="fa fa-smile-o fa-5x smiley" aria-hidden="true"><\/i><br /><br /><strong><p style="font-size:1.3em;">That\'s it! We\'ve complained to '+n+" on your behalf.<\/p><\/strong><br /><p style=\"font-size:0.9em;\">For the amount we pay, travelling on the UK's rail network should feel less like a chore. We're only in the early stages of development, but our vision is to arm every commuter with a means to be heard.<p>";$(t).find(".modal-body").empty();$(t).find(".modal-body").append(i);$(t).find(".modal-footer").empty();$(t).find(".modal-footer").append('<button type="button" class="btn btn-default" data-dismiss="modal">Close<\/button>')})}function showComplainModal(){var n=extractComplaintInformation(this),i=n.expected=="Cancelled"?"cancelled":"delayed",r="<p>You selected the "+n.due+" ("+n.expected+") from "+n.originalSearch+" to "+n.destination+" operated by "+n.operator+".<\/p><p>"+n.delayReason.replace("{wording}",i)+"<\/p><p>Still want to complain?<\/p>",t=$("#complain-modal");return $(t).find(".modal-body").empty(),$(t).find(".modal-body").append(r),$(t).find(".modal-footer").empty(),$(t).find(".modal-footer").append('<button id="complain-btn" type="button" class="btn btn-danger" data-url="/Home/Complain">Shout it from the rooftops!&nbsp;&nbsp;<i class="fa fa-bullhorn" aria-hidden="true"><\/i><\/button>'),$(t).modal(),$(t).show(),complaintToPost=n,!1}function extractComplaintInformation(n){var r="",f=$(n).find("td.destination-body").text(),e=$(n).find("td.expected-body").text(),i=$(n).find("td.due-body").html(),u,t;return i=i.substr(0,i.indexOf("<")),u=$(n).find("td.operator-body").text(),t={},t.originalSearch=originalSearch,t.destination=f,t.due=i,t.operator=u,t.expected=e,r=$(n).has("input").length>0?"<strong>"+$(n).find("input").val()+"<\/strong>.":"It doesn't look like there's a formal reason why this train is delayed.",t.delayReason=r,t}function submitStation(){var t=$("#selected-station").val();if(t=="")return $("#alert-no-station").show(),!1;var r=$(this).data("url"),n=$("#station-search"),i=$("#search-again"),u=$("#no-trains");$(n).empty();$(n).append(loadingIcon);$.get(r,{selectedStation:t},function(t){var r=$("#departures"),e=$(".body-content"),f=$("#departures-table > tbody");t==null||t.departureModels==null?($(n).hide(),$(u).show(),$(i).show()):($(n).hide(),$.each(t.departureModels,function(n,t){var r=t.cancellationReason==null?!1:!0,u=t.delayReason==null?!1:!0,o=t.expected=="On time"?!0:!1,i="",e;o?i=departureRowHtml.replace("{context}","success").replace("{status}",allGoodIcon):r||u?(reasonInput=!r&&u?reasonInput.replace("{reason-string}",t.delayReason):reasonInput.replace("{reason-string}",t.cancellationReason),i=departureRowHtml.replace("{context}","danger").replace("{status}",warningIcon).replace("{reason}",reasonInput)):i=departureRowHtml.replace("{context}","warning").replace("{status}",alertIcon);t.platform==null&&(t.platform="");e=i.replace("{destination}",t.destinationName).replace("{due}",t.due).replace("{expected}",t.expected).replace("{expected}",t.expected).replace("{platform}",t.platform).replace("{operator}",t.operator);$(f).append(e)}),$("#departures-note").text("Here are the departures from '"+originalSearch+"' in the next hour..."),$(r).show(),$(i).show())})}var departureRowHtml='<tr class="{context}"><td class="status-body">{status}<\/td><td class="destination-body">{destination}<\/td><td class="due-body">{due}<span class="expected-mob">{expected}<\/span><\/td><td class="expected-body">{expected}<\/td><td>{platform}<\/td><td class="operator-body">{operator}<\/td>{reason}';"<\/tr>";var warningIcon='<i class="fa fa-exclamation-circle" aria-hidden="true"><\/i>',alertIcon='<i class="fa fa-exclamation-triangle" aria-hidden="true"><\/i>',allGoodIcon='<i class="fa fa-check-circle-o" aria-hidden="true"><\/i>',loadingIcon='<i class="fa fa-cog fa-spin fa-3x fa-fw"><\/i><span class="sr-only">Loading...<\/span>',reasonInput='<input class="delay-reason" type="hidden" value="{reason-string}" />',originalSearch="",complaintToPost={};$(function(){$("#station").autocomplete({source:function(n,t){$.ajax({url:"/Home/SearchStations",dataType:"json",data:{term:n.term},success:function(n){t(n)}})},minLength:1,select:function(n,t){originalSearch=t.item.value;$("#station").text(t.item.value);$("#selected-station").val(t.item.key)}});$("#submit-station").click(submitStation);$(document).on("click touchstart","#departures-table > tbody > tr.danger, #departures-table > tbody > tr.warning",showComplainModal);$(document).on("click","#complain-btn",postComplaint)});